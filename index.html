<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FCÏò®ÎùºÏù∏ Í∞êÎèÖÎ™®Îìú & Ïù¥Ï†ÅÏãúÏû• ÌÉÄÏù¥Î®∏ v1.1.1</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .main-container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 15px 15px 0 0;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            border: none;
            background: #f8f9fa;
            color: #666;
        }
        
        .tab.active {
            background: #667eea;
            color: white;
        }
        
        .content {
            background: white;
            border-radius: 0 0 15px 15px;
            padding: 30px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.2);
            min-height: 500px;
        }
        
        .current-time {
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            color: #ffffff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
        }
        
        /* Í∞êÎèÖÎ™®Îìú ÌÉÄÏù¥Î®∏ Ïä§ÌÉÄÏùº */
        .timer-section {
            text-align: center;
        }
        
        .title {
            color: #333;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .timer-display {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }
        
        .status {
            font-size: 16px;
            margin: 15px 0;
            color: #666;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        
        button {
            padding: 12px 20px;
            font-size: 15px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .start-btn { 
            background: #4CAF50; 
            color: white; 
            padding: 15px 30px;
            font-size: 18px;
        }
        .start-btn:hover { background: #45a049; transform: scale(1.05); }
        
        .stop-btn { 
            background: #f44336; 
            color: white;
            padding: 15px 30px;
            font-size: 18px;
        }
        .stop-btn:hover { background: #da190b; transform: scale(1.05); }
        
        .add-btn { background: #FF9800; color: white; }
        .add-btn:hover { background: #e68900; transform: scale(1.05); }
        
        .reset-btn { background: #607D8B; color: white; }
        .reset-btn:hover { background: #4e636e; transform: scale(1.05); }
        
        /* Ïù¥Ï†ÅÏãúÏû• Ïä§ÌÉÄÏùº */
        .transfer-section {
            display: none;
        }
        
        .transfer-section.active {
            display: block;
        }
        
        .file-upload {
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #667eea;
            border-radius: 10px;
            text-align: center;
        }
        
        .file-input {
            margin: 10px;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .add-player-btn {
            background: #4CAF50;
            color: white;
            padding: 12px 24px;
            font-size: 16px;
        }
        
        .download-btn {
            background: #2196F3;
            color: white;
            padding: 12px 24px;
            font-size: 16px;
        }
        
        .player-list {
            margin-top: 20px;
        }
        
        .player-item {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #667eea;
        }
        
        .player-item.editing {
            background: #fff3cd;
            border-left-color: #ffc107;
        }
        
        .player-item.notification-enabled {
            background: linear-gradient(135deg, #f3f4ff 0%, #e8ebff 100%);
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }
        
        .player-info {
            flex: 1;
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .player-name {
            font-weight: bold;
            font-size: 16px;
            color: #333;
            min-width: 120px;
        }
        
        .player-details {
            font-size: 14px;
            color: #666;
            min-width: 100px;
        }
        
        .next-update {
            font-size: 12px;
            color: #667eea;
            font-weight: bold;
            min-width: 80px;
        }
        
        .player-actions {
            display: flex;
            gap: 5px;
        }
        
        .edit-btn {
            background: #2196F3;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .delete-btn {
            background: #f44336;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .save-btn {
            background: #4CAF50;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .cancel-btn {
            background: #6c757d;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
        }
        
        /* ÏÑ†Ïàò Ï∂îÍ∞Ä/Ìé∏Ïßë Ìèº */
        .player-form {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin: 10px 0;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .form-group label {
            font-weight: bold;
            font-size: 14px;
        }
        
        .form-group input, .form-group select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }
        
        /* Ïù∏ÎùºÏù∏ Ìé∏Ïßë */
        .inline-input {
            padding: 4px;
            border: 1px solid #667eea;
            border-radius: 4px;
            font-size: 14px;
            width: 100px;
        }
        
        /* ÏïåÎ¶º ÌåùÏóÖ */
        .alert-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #ff4444;
            color: white;
            padding: 30px;
            border-radius: 15px;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 1000;
            display: none;
            text-align: center;
            max-width: 400px;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 999;
            display: none;
        }
        
        .close-btn {
            background: white;
            color: #ff4444;
            padding: 10px 20px;
            margin-top: 15px;
            border-radius: 8px;
        }
        
        .transfer-alert {
            background: #4CAF50;
        }
        
        .no-players {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px;
        }

        .timer-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 14px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- ÌòÑÏû¨ ÏãúÍ∞Ñ -->
        <div class="current-time" id="currentTime">Loading...</div>
        
        <!-- ÌÉ≠ Î©îÎâ¥ -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('supervisor')">‚öΩ Í∞êÎèÖÎ™®Îìú ÌÉÄÏù¥Î®∏</button>
            <button class="tab" onclick="switchTab('transfer')">üìà Ïù¥Ï†ÅÏãúÏû• ÏïåÎ¶º</button>
        </div>
        
        <!-- Ïª®ÌÖêÏ∏† ÏòÅÏó≠ -->
        <div class="content">
            <!-- Í∞êÎèÖÎ™®Îìú ÌÉÄÏù¥Î®∏ ÏÑπÏÖò -->
            <div class="timer-section" id="supervisorSection">
                <div class="title">Í∞êÎèÖÎ™®Îìú ÌÉÄÏù¥Î®∏ v3.0</div>
                
                <div class="timer-display" id="timerDisplay">11:00</div>
                
                <div class="status" id="status">Ï§ÄÎπÑ ÏÉÅÌÉú - ÏãúÏûë Î≤ÑÌäºÏùÑ ÎàåÎü¨ 11Î∂Ñ ÌÉÄÏù¥Î®∏Î•º ÏãúÏûëÌïòÏÑ∏Ïöî</div>
                
                <div class="buttons">
                    <button class="start-btn" id="startBtn" onclick="startTimer(11)">11Î∂Ñ ÏãúÏûë</button>
                    <button class="stop-btn" id="stopBtn" onclick="stopTimer()" style="display:none;">Ï†ïÏßÄ</button>
                    <button class="reset-btn" onclick="resetToEleven()">11Î∂ÑÏúºÎ°ú Î¶¨ÏÖã</button>
                </div>
                
                <div class="buttons">
                    <button class="add-btn" onclick="addOrStartTimer(5)">+5Î∂Ñ (Ïó∞Ïû•Ï†Ñ)</button>
                    <button class="add-btn" onclick="addOrStartTimer(1)">+1Î∂Ñ (Ï°∞Ï†ï)</button>
                </div>

                <div class="timer-info">
                    üí° <strong>ÏÇ¨Ïö©Î≤ï:</strong><br>
                    ‚Ä¢ <strong>11Î∂Ñ ÏãúÏûë</strong>: Í∏∞Î≥∏ 11Î∂Ñ ÌÉÄÏù¥Î®∏ ÏãúÏûë<br>
                    ‚Ä¢ <strong>+5Î∂Ñ/+1Î∂Ñ</strong>: ÌÉÄÏù¥Î®∏ Ï†ïÏßÄ ÏÉÅÌÉúÎ©¥ Ìï¥Îãπ ÏãúÍ∞ÑÏúºÎ°ú ÏãúÏûë, ÏßÑÌñâ Ï§ëÏù¥Î©¥ ÏãúÍ∞Ñ Ï∂îÍ∞Ä<br>
                    ‚Ä¢ <strong>ÏïåÎ¶º ÌõÑ</strong>: ÏûêÎèôÏúºÎ°ú Ï†ïÏßÄ ÏÉÅÌÉú ‚Üí Îã§Ïãú ÏãúÏûëÌïòÎ†§Î©¥ Î≤ÑÌäº ÌÅ¥Î¶≠<br>
                    ‚Ä¢ <strong>Ïó∞Ïû•Ï†Ñ</strong>: ÏïåÎ¶º Ïö∏Î¶∞ ÌõÑ +5Î∂Ñ ÎàÑÎ•¥Î©¥ 5Î∂Ñ ÌÉÄÏù¥Î®∏ ÏãúÏûë
                </div>
            </div>
            
            <!-- Ïù¥Ï†ÅÏãúÏû• ÏïåÎ¶º ÏÑπÏÖò -->
            <div class="transfer-section" id="transferSection">
                <div class="title">Ïù¥Ï†ÅÏãúÏû• Í∞±Ïã† ÏïåÎ¶º v1.1.1</div>
                
                <div class="file-upload">
                    <div>üìÅ ÏÑ†ÏàòÎ™©Î°ù.csv ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÍ±∞ÎÇò ÏßÅÏ†ë Ï∂îÍ∞ÄÌïòÏÑ∏Ïöî</div>
                    <input type="file" class="file-input" id="csvFile" accept=".csv" onchange="loadCSV()">
                    <div style="font-size: 12px; color: #666; margin-top: 10px;">
                        CSV ÌòïÏãù: ÏÑ†ÏàòÎ™Ö,ÏãúÏ¶å,Í∞±Ïã†Ìå®ÌÑ¥,Í∞±Ïã†Î∂Ñ
                    </div>
                </div>
                
                <div class="controls">
                    <button class="add-player-btn" onclick="showAddForm()">‚ûï ÏÑ†Ïàò Ï∂îÍ∞Ä</button>
                    <button class="download-btn" onclick="downloadCSV()">üíæ CSV Îã§Ïö¥Î°úÎìú</button>
                </div>
                
                <!-- ÌïÑÌÑ∞ Î∞è Í≤ÄÏÉâ -->
                <div style="margin: 20px 0; text-align: center;">
                    <div style="margin-bottom: 15px;">
                        <button id="filterToggle" onclick="toggleFilter()" 
                                style="padding: 10px 20px; border-radius: 5px; border: none; background: #667eea; color: white; font-weight: bold; cursor: pointer; margin-right: 10px;">
                            üìå ÏïåÎ¶º ÏÑ§Ï†ïÎêú ÏÑ†ÏàòÎßå Î≥¥Í∏∞
                        </button>
                        <span id="notificationCount" style="color: #667eea; font-weight: bold;">ÏïåÎ¶º ÌôúÏÑ±: 0/0Î™Ö</span>
                    </div>
                    <input type="text" id="playerSearch" placeholder="üîç ÏÑ†ÏàòÎ™Ö ÎòêÎäî ÏãúÏ¶å Í≤ÄÏÉâ..." 
                           style="padding: 10px; width: 300px; border-radius: 5px; border: 1px solid #ddd; font-size: 14px;"
                           onkeyup="searchPlayers()">
                    <span id="searchCount" style="margin-left: 10px; color: #667eea; font-weight: bold;"></span>
                </div>
                
                <!-- ÏÑ†Ïàò Ï∂îÍ∞Ä/Ìé∏Ïßë Ìèº -->
                <div class="player-form" id="playerForm">
                    <h3 id="formTitle">ÏÉà ÏÑ†Ïàò Ï∂îÍ∞Ä</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ÏÑ†ÏàòÎ™Ö:</label>
                            <input type="text" id="playerName" placeholder="Ïòà: Î©îÏãú">
                        </div>
                        <div class="form-group">
                            <label>ÏãúÏ¶å:</label>
                            <input type="text" id="playerSeason" placeholder="Ïòà: 22TOTY">
                        </div>
                        <div class="form-group">
                            <label>Í∞±Ïã†Ìå®ÌÑ¥:</label>
                            <select id="playerPattern">
                                <option value="ÏßùÏàòÏãú">ÏßùÏàòÏãú</option>
                                <option value="ÌôÄÏàòÏãú">ÌôÄÏàòÏãú</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Í∞±Ïã†Î∂Ñ:</label>
                            <input type="number" id="playerMinute" min="0" max="59" placeholder="Ïòà: 04">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button class="save-btn" onclick="savePlayer()">Ï†ÄÏû•</button>
                        <button class="cancel-btn" onclick="hideForm()">Ï∑®ÏÜå</button>
                    </div>
                </div>
                
                <div class="player-list" id="playerList">
                    <div class="no-players">ÏÑ†ÏàòÎ•º Ï∂îÍ∞ÄÌïòÍ±∞ÎÇò CSV ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÏÑ∏Ïöî</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ÏïåÎ¶º ÌåùÏóÖ -->
    <div class="overlay" id="overlay" onclick="closeAlert()"></div>
    <div class="alert-popup" id="alertPopup">
        <div id="alertMessage">ÏïåÎ¶º</div>
        <button class="close-btn" onclick="closeAlert()">ÌôïÏù∏</button>
    </div>

    <script>
        // Electron API Ï≤¥ÌÅ¨
        const isElectron = typeof window.electronAPI !== 'undefined';
        
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let timeLeft = 660; // 11Î∂Ñ = 660Ï¥à
        let timerId = null;
        let isRunning = false;
        let players = [];
        let transferTimers = [];
        let editingIndex = -1;
        let notificationSettings = JSON.parse(localStorage.getItem('notificationSettings') || '{}');
        let showOnlyEnabled = true; // Í∏∞Î≥∏Í∞í: ÏïåÎ¶º ÏÑ§Ï†ïÎêú ÏÑ†ÏàòÎßå Î≥¥Í∏∞
        
        // ÌòÑÏû¨ ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleString('ko-KR', {
                timeZone: 'Asia/Seoul',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('currentTime').textContent = timeString;
        }
        
        // ÌÉ≠ Ï†ÑÌôò
        function switchTab(tab) {
            // ÌÉ≠ Î≤ÑÌäº ÌôúÏÑ±Ìôî
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            // ÏÑπÏÖò ÌëúÏãú/Ïà®ÍπÄ
            document.getElementById('supervisorSection').style.display = tab === 'supervisor' ? 'block' : 'none';
            document.getElementById('transferSection').style.display = tab === 'transfer' ? 'block' : 'none';
        }
        
        // Í∞êÎèÖÎ™®Îìú ÌÉÄÏù¥Î®∏ Ìï®ÏàòÎì§
        function updateDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timerDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // ÌÉÄÏù¥Î®∏ ÏãúÏûë (Î∂Ñ Îã®ÏúÑÎ°ú ÏÑ§Ï†ï Í∞ÄÎä•)
        function startTimer(minutes) {
            if (isRunning) return;
            
            // Î∂ÑÏù¥ ÏßÄÏ†ïÎêòÎ©¥ Ìï¥Îãπ ÏãúÍ∞ÑÏúºÎ°ú ÏÑ§Ï†ï
            if (minutes) {
                timeLeft = minutes * 60;
            }
            
            // ÏãúÍ∞ÑÏù¥ 0Ïù¥Î©¥ 10Î∂ÑÏúºÎ°ú ÏÑ§Ï†ï
            if (timeLeft <= 0) {
                timeLeft = 660;
            }
            
            isRunning = true;
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'inline-block';
            document.getElementById('status').textContent = 'ÌÉÄÏù¥Î®∏ ÏûëÎèô Ï§ë...';
            
            updateDisplay();
            
            // Electron ÌôòÍ≤ΩÏù¥Î©¥ Î©îÏù∏ ÌîÑÎ°úÏÑ∏Ïä§ÏóêÎèÑ ÏïåÎ¶º
            if (isElectron) {
                window.electronAPI.startTimer(minutes || timeLeft / 60);
            }
            
            timerId = setInterval(() => {
                timeLeft--;
                updateDisplay();
                
                if (timeLeft <= 0) {
                    showAlert('üö® Í∞êÎèÖÎ™®Îìú Ïã§Ìñâ ÏãúÍ∞Ñ!', 'FCÏò®ÎùºÏù∏ÏóêÏÑú Í∞êÎèÖÎ™®ÎìúÎ•º Ïã§ÌñâÌïòÏÑ∏Ïöî');
                    stopTimer(); // ÏïåÎ¶º ÌõÑ Ï†ïÏßÄ (Î¶¨ÏÖãÌïòÏßÄ ÏïäÏùå)
                }
            }, 1000);
        }

        // ÌÉÄÏù¥Î®∏ Ï†ïÏßÄ
        function stopTimer() {
            if (!isRunning) return;
            
            isRunning = false;
            clearInterval(timerId);
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('stopBtn').style.display = 'none';
            
            // Electron ÌôòÍ≤ΩÏù¥Î©¥ Î©îÏù∏ ÌîÑÎ°úÏÑ∏Ïä§ÏóêÎèÑ ÏïåÎ¶º
            if (isElectron) {
                window.electronAPI.stopTimer();
            }
            
            if (timeLeft <= 0) {
                document.getElementById('status').textContent = 'ÏïåÎ¶º ÏôÑÎ£å - Îã§Ïãú ÏãúÏûëÌïòÎ†§Î©¥ Î≤ÑÌäºÏùÑ ÎàÑÎ•¥ÏÑ∏Ïöî';
                timeLeft = 0; // 0ÏúºÎ°ú Ïú†ÏßÄ
            } else {
                document.getElementById('status').textContent = 'ÏùºÏãúÏ†ïÏßÄ - Í≥ÑÏÜçÌïòÎ†§Î©¥ ÏãúÏûë Î≤ÑÌäºÏùÑ ÎàÑÎ•¥ÏÑ∏Ïöî';
            }
            
            updateDisplay();
        }

        // 11Î∂ÑÏúºÎ°ú Î¶¨ÏÖã
        function resetToEleven() {
            if (isRunning) {
                stopTimer();
            }
            timeLeft = 660; // 11Î∂Ñ
            updateDisplay();
            document.getElementById('status').textContent = '11Î∂ÑÏúºÎ°ú Î¶¨ÏÖãÎê® - ÏãúÏûë Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî';
        }

        // ÏãúÍ∞Ñ Ï∂îÍ∞Ä ÎòêÎäî ÏÉàÎ°ú ÏãúÏûë
        function addOrStartTimer(minutes) {
            if (isRunning) {
                // ÌÉÄÏù¥Î®∏ ÏßÑÌñâ Ï§ëÏù¥Î©¥ ÏãúÍ∞Ñ Ï∂îÍ∞Ä
                timeLeft += minutes * 60;
                updateDisplay();
                
                // Electron ÌôòÍ≤ΩÏù¥Î©¥ Î©îÏù∏ ÌîÑÎ°úÏÑ∏Ïä§ÏóêÎèÑ ÏïåÎ¶º
                if (isElectron) {
                    window.electronAPI.addTime(minutes);
                }
                
                if (minutes === 5) {
                    document.getElementById('status').textContent = `Ïó∞Ïû•Ï†Ñ +${minutes}Î∂Ñ Ï∂îÍ∞ÄÎê® (ÏßÑÌñâ Ï§ë)`;
                } else {
                    document.getElementById('status').textContent = `+${minutes}Î∂Ñ Ï∂îÍ∞ÄÎê® (ÏßÑÌñâ Ï§ë)`;
                }
            } else {
                // ÌÉÄÏù¥Î®∏ Ï†ïÏßÄ ÏÉÅÌÉúÎ©¥ Ìï¥Îãπ ÏãúÍ∞ÑÏúºÎ°ú ÏÉàÎ°ú ÏãúÏûë
                timeLeft = minutes * 60;
                updateDisplay();
                
                if (minutes === 5) {
                    document.getElementById('status').textContent = 'Ïó∞Ïû•Ï†Ñ 5Î∂Ñ ÌÉÄÏù¥Î®∏ ÏãúÏûë';
                } else {
                    document.getElementById('status').textContent = `${minutes}Î∂Ñ ÌÉÄÏù¥Î®∏ ÏãúÏûë`;
                }
                
                startTimer(); // ÏûêÎèô ÏãúÏûë
            }
        }
        
        // CSV ÌååÏùº Î°úÎìú
        function loadCSV() {
            const fileInput = document.getElementById('csvFile');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const csv = e.target.result;
                parseCSV(csv);
            };
            reader.readAsText(file, 'UTF-8');
        }
        
        // CSV ÌååÏã±
        function parseCSV(csv) {
            const lines = csv.split('\n');
            players = [];
            
            // Ï≤´ Î≤àÏß∏ Ï§Ñ(Ìó§Îçî) Ï†úÏô∏
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const [name, season, pattern, minute] = line.split(',');
                if (name && season && pattern && minute) {
                    players.push({
                        name: name.trim(),
                        season: season.trim(),
                        pattern: pattern.trim(),
                        minute: parseInt(minute.trim())
                    });
                }
            }
            
            displayPlayers();
            setupTransferAlerts();
        }
        
        // ÏÑ†Ïàò Í≤ÄÏÉâ
        function searchPlayers() {
            const searchTerm = document.getElementById('playerSearch').value.toLowerCase();
            const filteredPlayers = searchTerm ? 
                players.filter(player => 
                    player.name.toLowerCase().includes(searchTerm) || 
                    player.season.toLowerCase().includes(searchTerm)
                ) : players;
            
            displayPlayers(filteredPlayers);
            
            // Í≤ÄÏÉâ Í≤∞Í≥º Ïàò ÌëúÏãú
            const searchCount = document.getElementById('searchCount');
            if (searchTerm) {
                searchCount.textContent = `${filteredPlayers.length}Î™Ö Ï∞æÏùå`;
            } else {
                searchCount.textContent = '';
            }
        }
        
        // ÏÑ†Ïàò Î™©Î°ù ÌëúÏãú
        function displayPlayers(playersToShow = players) {
            const playerList = document.getElementById('playerList');
            
            // ÏïåÎ¶º Ïπ¥Ïö¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
            updateNotificationCount();
            
            // ÌïÑÌÑ∞ Ï†ÅÏö©
            let filteredPlayers = playersToShow;
            if (showOnlyEnabled) {
                filteredPlayers = playersToShow.filter(player => {
                    const key = `${player.season}_${player.name}`;
                    return notificationSettings[key] === true;
                });
            }
            
            if (filteredPlayers.length === 0) {
                if (players.length === 0) {
                    playerList.innerHTML = '<div class="no-players">ÏÑ†ÏàòÎ•º Ï∂îÍ∞ÄÌïòÍ±∞ÎÇò CSV ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÏÑ∏Ïöî</div>';
                } else if (showOnlyEnabled) {
                    playerList.innerHTML = '<div class="no-players">ÏïåÎ¶ºÏù¥ ÏÑ§Ï†ïÎêú ÏÑ†ÏàòÍ∞Ä ÏóÜÏäµÎãàÎã§<br>Ï†ÑÏ≤¥ Î≥¥Í∏∞Î°ú Ï†ÑÌôòÌïòÏó¨ ÏÑ†ÏàòÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>';
                } else {
                    playerList.innerHTML = '<div class="no-players">Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§</div>';
                }
                return;
            }
            
            // ÏïåÎ¶º ÏÑ§Ï†ïÎêú ÏÑ†ÏàòÎ•º ÏÉÅÎã®Ïóê Ï†ïÎ†¨
            const sortedPlayers = [...filteredPlayers].sort((a, b) => {
                const keyA = `${a.season}_${a.name}`;
                const keyB = `${b.season}_${b.name}`;
                const enabledA = notificationSettings[keyA] || false;
                const enabledB = notificationSettings[keyB] || false;
                
                if (enabledA && !enabledB) return -1;
                if (!enabledA && enabledB) return 1;
                return 0;
            });
            
            // ÏõêÎ≥∏ Î∞∞Ïó¥ÏóêÏÑú Ïù∏Îç±Ïä§ Ï∞æÍ∏∞
            playerList.innerHTML = sortedPlayers.map((player) => {
                const originalIndex = players.indexOf(player);
                const nextUpdate = getNextUpdateTime(player);
                const isEditing = editingIndex === originalIndex;
                const key = `${player.season}_${player.name}`;
                const isEnabled = notificationSettings[key] || false;
                
                if (isEditing) {
                    return `
                        <div class="player-item editing">
                            <div class="player-info">
                                <input class="inline-input" value="${player.name}" id="edit-name-${originalIndex}">
                                <input class="inline-input" value="${player.season}" id="edit-season-${originalIndex}">
                                <select class="inline-input" id="edit-pattern-${originalIndex}">
                                    <option value="ÏßùÏàòÏãú" ${player.pattern === 'ÏßùÏàòÏãú' ? 'selected' : ''}>ÏßùÏàòÏãú</option>
                                    <option value="ÌôÄÏàòÏãú" ${player.pattern === 'ÌôÄÏàòÏãú' ? 'selected' : ''}>ÌôÄÏàòÏãú</option>
                                </select>
                                <input class="inline-input" type="number" min="0" max="59" value="${player.minute}" id="edit-minute-${originalIndex}">
                            </div>
                            <div class="player-actions">
                                <button class="save-btn" onclick="saveEdit(${originalIndex})">Ï†ÄÏû•</button>
                                <button class="cancel-btn" onclick="cancelEdit()">Ï∑®ÏÜå</button>
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="player-item ${isEnabled ? 'notification-enabled' : ''}">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" 
                                       id="notify-${originalIndex}" 
                                       ${isEnabled ? 'checked' : ''}
                                       onchange="toggleNotification(${originalIndex})"
                                       style="width: 20px; height: 20px; cursor: pointer;">
                                <div class="player-info" style="flex: 1;">
                                    <div class="player-name">
                                        ${isEnabled ? '‚≠ê ' : ''}${player.season} ${player.name}
                                    </div>
                                    <div class="player-details">${player.pattern} ${player.minute.toString().padStart(2, '0')}Î∂Ñ</div>
                                    <div class="next-update">Îã§Ïùå: ${nextUpdate}</div>
                                </div>
                                <div class="player-actions">
                                    <button class="edit-btn" onclick="editPlayer(${originalIndex})">ÏàòÏ†ï</button>
                                    <button class="delete-btn" onclick="deletePlayer(${originalIndex})">ÏÇ≠Ï†ú</button>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }).join('');
        }
        
        // ÏÑ†Ïàò Ï∂îÍ∞Ä Ìèº ÌëúÏãú
        function showAddForm() {
            editingIndex = -1;
            document.getElementById('formTitle').textContent = 'ÏÉà ÏÑ†Ïàò Ï∂îÍ∞Ä';
            document.getElementById('playerName').value = '';
            document.getElementById('playerSeason').value = '';
            document.getElementById('playerPattern').value = 'ÏßùÏàòÏãú';
            document.getElementById('playerMinute').value = '';
            document.getElementById('playerForm').style.display = 'block';
        }
        
        // Ìèº Ïà®Í∏∞Í∏∞
        function hideForm() {
            document.getElementById('playerForm').style.display = 'none';
            editingIndex = -1;
        }
        
        // ÏÑ†Ïàò Ï†ÄÏû•
        function savePlayer() {
            const name = document.getElementById('playerName').value.trim();
            const season = document.getElementById('playerSeason').value.trim();
            const pattern = document.getElementById('playerPattern').value;
            const minute = parseInt(document.getElementById('playerMinute').value);
            
            if (!name || !season || isNaN(minute) || minute < 0 || minute > 59) {
                alert('Î™®Îì† ÌïÑÎìúÎ•º Ïò¨Î∞îÎ•¥Í≤å ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            const newPlayer = { name, season, pattern, minute };
            
            if (editingIndex >= 0) {
                players[editingIndex] = newPlayer;
            } else {
                players.push(newPlayer);
            }
            
            hideForm();
            displayPlayers();
            setupTransferAlerts();
        }
        
        // ÏÑ†Ïàò Ìé∏Ïßë
        function editPlayer(index) {
            if (editingIndex >= 0) {
                cancelEdit();
            }
            editingIndex = index;
            displayPlayers();
        }
        
        // Ìé∏Ïßë Ï†ÄÏû•
        function saveEdit(index) {
            const name = document.getElementById(`edit-name-${index}`).value.trim();
            const season = document.getElementById(`edit-season-${index}`).value.trim();
            const pattern = document.getElementById(`edit-pattern-${index}`).value;
            const minute = parseInt(document.getElementById(`edit-minute-${index}`).value);
            
            if (!name || !season || isNaN(minute) || minute < 0 || minute > 59) {
                alert('Î™®Îì† ÌïÑÎìúÎ•º Ïò¨Î∞îÎ•¥Í≤å ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            players[index] = { name, season, pattern, minute };
            editingIndex = -1;
            displayPlayers();
            setupTransferAlerts();
        }
        
        // Ìé∏Ïßë Ï∑®ÏÜå
        function cancelEdit() {
            editingIndex = -1;
            displayPlayers();
        }
        
        // ÏÑ†Ïàò ÏÇ≠Ï†ú
        function deletePlayer(index) {
            if (confirm(`${players[index].season} ${players[index].name}ÏùÑ(Î•º) ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                players.splice(index, 1);
                displayPlayers();
                setupTransferAlerts();
            }
        }
        
        // CSV Îã§Ïö¥Î°úÎìú
        function downloadCSV() {
            if (players.length === 0) {
                alert('Îã§Ïö¥Î°úÎìúÌï† ÏÑ†Ïàò Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            let csvContent = 'ÏÑ†ÏàòÎ™Ö,ÏãúÏ¶å,Í∞±Ïã†Ìå®ÌÑ¥,Í∞±Ïã†Î∂Ñ\n';
            players.forEach(player => {
                csvContent += `${player.name},${player.season},${player.pattern},${player.minute}\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'ÏÑ†ÏàòÎ™©Î°ù.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Îã§Ïùå Í∞±Ïã† ÏãúÍ∞Ñ Í≥ÑÏÇ∞
        function getNextUpdateTime(player) {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            
            let nextHour;
            
            if (player.pattern === 'ÏßùÏàòÏãú') {
                if (currentHour % 2 === 0) {
                    if (currentMinute < player.minute) {
                        nextHour = currentHour;
                    } else {
                        nextHour = currentHour + 2;
                    }
                } else {
                    nextHour = currentHour + 1;
                }
            } else {
                if (currentHour % 2 === 1) {
                    if (currentMinute < player.minute) {
                        nextHour = currentHour;
                    } else {
                        nextHour = currentHour + 2;
                    }
                } else {
                    nextHour = currentHour + 1;
                }
            }
            
            if (nextHour >= 24) {
                nextHour -= 24;
            }
            
            return `${nextHour.toString().padStart(2, '0')}:${player.minute.toString().padStart(2, '0')}`;
        }
        
        // Ïù¥Ï†ÅÏãúÏû• ÏïåÎ¶º ÏÑ§Ï†ï
        function setupTransferAlerts() {
            transferTimers.forEach(timer => clearInterval(timer));
            transferTimers = [];
            
            players.forEach(player => {
                const timer = setInterval(() => {
                    checkTransferUpdate(player);
                }, 60000);
                
                transferTimers.push(timer);
            });
        }
        
        // ÏïåÎ¶º ÌÜ†Í∏Ä
        function toggleNotification(index) {
            const player = players[index];
            const key = `${player.season}_${player.name}`;
            notificationSettings[key] = !notificationSettings[key];
            localStorage.setItem('notificationSettings', JSON.stringify(notificationSettings));
            displayPlayers();
        }
        
        // ÌïÑÌÑ∞ ÌÜ†Í∏Ä
        function toggleFilter() {
            showOnlyEnabled = !showOnlyEnabled;
            const button = document.getElementById('filterToggle');
            if (showOnlyEnabled) {
                button.textContent = 'üìå ÏïåÎ¶º ÏÑ§Ï†ïÎêú ÏÑ†ÏàòÎßå Î≥¥Í∏∞';
                button.style.background = '#667eea';
            } else {
                button.textContent = 'üìã Ï†ÑÏ≤¥ ÏÑ†Ïàò Î≥¥Í∏∞';
                button.style.background = '#6c757d';
            }
            displayPlayers();
        }
        
        // ÏïåÎ¶º Ïπ¥Ïö¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
        function updateNotificationCount() {
            const enabledCount = Object.keys(notificationSettings).filter(key => notificationSettings[key]).length;
            const totalCount = players.length;
            document.getElementById('notificationCount').textContent = `ÏïåÎ¶º ÌôúÏÑ±: ${enabledCount}/${totalCount}Î™Ö`;
        }
        
        // Ïù¥Ï†ÅÏãúÏû• Í∞±Ïã† Ï≤¥ÌÅ¨
        function checkTransferUpdate(player) {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            
            // ÏïåÎ¶º ÏÑ§Ï†ï ÌôïÏù∏
            const key = `${player.season}_${player.name}`;
            if (!notificationSettings[key]) {
                return; // ÏïåÎ¶º OFFÎ©¥ Ï≤¥ÌÅ¨ÌïòÏßÄ ÏïäÏùå
            }
            
            let shouldAlert = false;
            
            if (player.pattern === 'ÏßùÏàòÏãú' && currentHour % 2 === 0 && currentMinute === player.minute) {
                shouldAlert = true;
            } else if (player.pattern === 'ÌôÄÏàòÏãú' && currentHour % 2 === 1 && currentMinute === player.minute) {
                shouldAlert = true;
            }
            
            if (shouldAlert) {
                showAlert(
                    `üìà Ïù¥Ï†ÅÏãúÏû• Í∞±Ïã†!`, 
                    `${player.season} ${player.name}Ïùò Ïù¥Ï†ÅÎ£åÍ∞Ä Í∞±Ïã†ÎêòÏóàÏäµÎãàÎã§!`,
                    'transfer-alert'
                );
                
                // Electron ÌôòÍ≤ΩÏù¥Î©¥ ÏãúÏä§ÌÖú ÏïåÎ¶ºÎèÑ ÌëúÏãú
                if (isElectron) {
                    window.electronAPI.sendTransferAlert({
                        name: player.name,
                        season: player.season
                    });
                }
            }
        }
        
        // ÏïåÎ¶º ÌëúÏãú
        function showAlert(title, message, className = '') {
            document.getElementById('alertMessage').innerHTML = `
                <div>${title}</div>
                <div style="font-size: 16px; margin-top: 10px;">${message}</div>
            `;
            
            const popup = document.getElementById('alertPopup');
            popup.className = `alert-popup ${className}`;
            
            document.getElementById('overlay').style.display = 'block';
            popup.style.display = 'block';
            
            if (Notification.permission === 'granted') {
                new Notification(title, {
                    body: message,
                    icon: '‚öΩ'
                });
            }
        }
        
        // ÏïåÎ¶º Îã´Í∏∞
        function closeAlert() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('alertPopup').style.display = 'none';
            
            // Í∞êÎèÖÎ™®Îìú ÏïåÎ¶ºÏù¥ÏóàÏúºÎ©¥ ÏûêÎèôÏúºÎ°ú 10Î∂Ñ Ïû¨ÏãúÏûë
            const alertMessage = document.getElementById('alertMessage').textContent;
            if (alertMessage.includes('Í∞êÎèÖÎ™®Îìú')) {
                timeLeft = 660; // 11Î∂Ñ ÏÑ§Ï†ï
                startTimer(); // ÏûêÎèô ÏãúÏûë
                document.getElementById('status').textContent = '11Î∂Ñ ÌÉÄÏù¥Î®∏ ÏûêÎèô Ïû¨ÏãúÏûëÎê®';
            }
        }
        
        // Ï¥àÍ∏∞Ìôî
        function init() {
            updateDisplay();
            updateCurrentTime();
            
            setInterval(updateCurrentTime, 1000);
            
            // Electron ÌôòÍ≤ΩÏù¥Î©¥ ÌÉÄÏù¥Î®∏ ÏóÖÎç∞Ïù¥Ìä∏ Î¶¨Ïä§ÎÑà Îì±Î°ù
            if (isElectron) {
                window.electronAPI.onTimerUpdate((newTimeLeft) => {
                    timeLeft = newTimeLeft;
                    updateDisplay();
                    
                    if (newTimeLeft > 0 && !isRunning) {
                        isRunning = true;
                        document.getElementById('startBtn').style.display = 'none';
                        document.getElementById('stopBtn').style.display = 'inline-block';
                        document.getElementById('status').textContent = 'ÌÉÄÏù¥Î®∏ ÏûëÎèô Ï§ë...';
                    }
                });
            }
            
            if (Notification.permission !== 'granted' && Notification.permission !== 'denied') {
                Notification.requestPermission();
            }
            
            // all_players.csv ÏûêÎèô Î°úÎìú
            loadDefaultCSV();
        }
        
        // Í∏∞Î≥∏ CSV ÌååÏùº Î°úÎìú
        function loadDefaultCSV() {
            fetch('all_players.csv')
                .then(response => response.text())
                .then(csv => {
                    parseCSV(csv);
                    console.log(`${players.length}Î™ÖÏùò ÏÑ†Ïàò Îç∞Ïù¥ÌÑ∞Î•º Î°úÎìúÌñàÏäµÎãàÎã§.`);
                })
                .catch(error => {
                    console.log('Í∏∞Î≥∏ CSV ÌååÏùºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§. Îπà Î™©Î°ùÏúºÎ°ú ÏãúÏûëÌï©ÎãàÎã§.');
                    displayPlayers();
                });
        }
        
        window.onload = init;
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FCì˜¨ë¼ì¸ ê°ë…ëª¨ë“œ & ì´ì ì‹œì¥ íƒ€ì´ë¨¸ v1.1.1</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .main-container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 15px 15px 0 0;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            border: none;
            background: #f8f9fa;
            color: #666;
        }
        
        .tab.active {
            background: #667eea;
            color: white;
        }
        
        .content {
            background: white;
            border-radius: 0 0 15px 15px;
            padding: 30px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.2);
            min-height: 500px;
        }
        
        .current-time {
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            color: #ffffff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
        }
        
        /* ê°ë…ëª¨ë“œ íƒ€ì´ë¨¸ ìŠ¤íƒ€ì¼ */
        .timer-section {
            text-align: center;
        }
        
        .title {
            color: #333;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .timer-display {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }
        
        .status {
            font-size: 16px;
            margin: 15px 0;
            color: #666;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        
        button {
            padding: 12px 20px;
            font-size: 15px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .start-btn { 
            background: #4CAF50; 
            color: white; 
            padding: 15px 30px;
            font-size: 18px;
        }
        .start-btn:hover { background: #45a049; transform: scale(1.05); }
        
        .stop-btn { 
            background: #f44336; 
            color: white;
            padding: 15px 30px;
            font-size: 18px;
        }
        .stop-btn:hover { background: #da190b; transform: scale(1.05); }
        
        .add-btn { background: #FF9800; color: white; }
        .add-btn:hover { background: #e68900; transform: scale(1.05); }
        
        .reset-btn { background: #607D8B; color: white; }
        .reset-btn:hover { background: #4e636e; transform: scale(1.05); }
        
        /* ì´ì ì‹œì¥ ìŠ¤íƒ€ì¼ */
        .transfer-section {
            display: none;
        }
        
        .transfer-section.active {
            display: block;
        }
        
        .file-upload {
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #667eea;
            border-radius: 10px;
            text-align: center;
        }
        
        .file-input {
            margin: 10px;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .add-player-btn {
            background: #4CAF50;
            color: white;
            padding: 12px 24px;
            font-size: 16px;
        }
        
        .download-btn {
            background: #2196F3;
            color: white;
            padding: 12px 24px;
            font-size: 16px;
        }
        
        .player-list {
            margin-top: 20px;
        }
        
        .player-item {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #667eea;
        }
        
        .player-item.editing {
            background: #fff3cd;
            border-left-color: #ffc107;
        }
        
        .player-item.notification-enabled {
            background: linear-gradient(135deg, #f3f4ff 0%, #e8ebff 100%);
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }
        
        .player-info {
            flex: 1;
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .player-name {
            font-weight: bold;
            font-size: 16px;
            color: #333;
            min-width: 120px;
        }
        
        .player-details {
            font-size: 14px;
            color: #666;
            min-width: 100px;
        }
        
        .next-update {
            font-size: 12px;
            color: #667eea;
            font-weight: bold;
            min-width: 80px;
        }
        
        .player-actions {
            display: flex;
            gap: 5px;
        }
        
        .edit-btn {
            background: #2196F3;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .delete-btn {
            background: #f44336;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .save-btn {
            background: #4CAF50;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .cancel-btn {
            background: #6c757d;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
        }
        
        /* ì„ ìˆ˜ ì¶”ê°€/í¸ì§‘ í¼ */
        .player-form {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin: 10px 0;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .form-group label {
            font-weight: bold;
            font-size: 14px;
        }
        
        .form-group input, .form-group select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }
        
        /* ì¸ë¼ì¸ í¸ì§‘ */
        .inline-input {
            padding: 4px;
            border: 1px solid #667eea;
            border-radius: 4px;
            font-size: 14px;
            width: 100px;
        }
        
        /* ì•Œë¦¼ íŒì—… */
        .alert-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #ff4444;
            color: white;
            padding: 30px;
            border-radius: 15px;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 1000;
            display: none;
            text-align: center;
            max-width: 400px;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 999;
            display: none;
        }
        
        .close-btn {
            background: white;
            color: #ff4444;
            padding: 10px 20px;
            margin-top: 15px;
            border-radius: 8px;
        }
        
        .transfer-alert {
            background: #4CAF50;
        }
        
        .no-players {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px;
        }

        .timer-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 14px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- í˜„ì¬ ì‹œê°„ -->
        <div class="current-time" id="currentTime">Loading...</div>
        
        <!-- íƒ­ ë©”ë‰´ -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('supervisor')">âš½ ê°ë…ëª¨ë“œ íƒ€ì´ë¨¸</button>
            <button class="tab" onclick="switchTab('transfer')">ğŸ“ˆ ì´ì ì‹œì¥ ì•Œë¦¼</button>
        </div>
        
        <!-- ì»¨í…ì¸  ì˜ì—­ -->
        <div class="content">
            <!-- ê°ë…ëª¨ë“œ íƒ€ì´ë¨¸ ì„¹ì…˜ -->
            <div class="timer-section" id="supervisorSection">
                <div class="title">ê°ë…ëª¨ë“œ íƒ€ì´ë¨¸ v3.0</div>
                
                <div class="timer-display" id="timerDisplay">11:00</div>
                
                <div class="status" id="status">ì¤€ë¹„ ìƒíƒœ - ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ 11ë¶„ íƒ€ì´ë¨¸ë¥¼ ì‹œì‘í•˜ì„¸ìš”</div>
                
                <div class="buttons">
                    <button class="start-btn" id="startBtn" onclick="startTimer(11)">11ë¶„ ì‹œì‘</button>
                    <button class="stop-btn" id="stopBtn" onclick="stopTimer()" style="display:none;">ì •ì§€</button>
                    <button class="reset-btn" onclick="resetToEleven()">11ë¶„ìœ¼ë¡œ ë¦¬ì…‹</button>
                </div>
                
                <div class="buttons">
                    <button class="add-btn" onclick="addOrStartTimer(5)">+5ë¶„ (ì—°ì¥ì „)</button>
                    <button class="add-btn" onclick="addOrStartTimer(1)">+1ë¶„ (ì¡°ì •)</button>
                </div>

                <div class="timer-info">
                    ğŸ’¡ <strong>ì‚¬ìš©ë²•:</strong><br>
                    â€¢ <strong>11ë¶„ ì‹œì‘</strong>: ê¸°ë³¸ 11ë¶„ íƒ€ì´ë¨¸ ì‹œì‘<br>
                    â€¢ <strong>+5ë¶„/+1ë¶„</strong>: íƒ€ì´ë¨¸ ì •ì§€ ìƒíƒœë©´ í•´ë‹¹ ì‹œê°„ìœ¼ë¡œ ì‹œì‘, ì§„í–‰ ì¤‘ì´ë©´ ì‹œê°„ ì¶”ê°€<br>
                    â€¢ <strong>ì•Œë¦¼ í›„</strong>: ìë™ìœ¼ë¡œ ì •ì§€ ìƒíƒœ â†’ ë‹¤ì‹œ ì‹œì‘í•˜ë ¤ë©´ ë²„íŠ¼ í´ë¦­<br>
                    â€¢ <strong>ì—°ì¥ì „</strong>: ì•Œë¦¼ ìš¸ë¦° í›„ +5ë¶„ ëˆ„ë¥´ë©´ 5ë¶„ íƒ€ì´ë¨¸ ì‹œì‘
                </div>
            </div>
            
            <!-- ì´ì ì‹œì¥ ì•Œë¦¼ ì„¹ì…˜ -->
            <div class="transfer-section" id="transferSection">
                <div class="title">ì´ì ì‹œì¥ ê°±ì‹  ì•Œë¦¼ v1.1.1</div>
                
                <div class="file-upload">
                    <div>ğŸ“ ì„ ìˆ˜ëª©ë¡.csv íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê±°ë‚˜ ì§ì ‘ ì¶”ê°€í•˜ì„¸ìš”</div>
                    <input type="file" class="file-input" id="csvFile" accept=".csv" onchange="loadCSV()">
                    <div style="font-size: 12px; color: #666; margin-top: 10px;">
                        CSV í˜•ì‹: ì„ ìˆ˜ëª…,ì‹œì¦Œ,ê°±ì‹ íŒ¨í„´,ê°±ì‹ ë¶„
                    </div>
                </div>
                
                <div class="controls">
                    <button class="add-player-btn" onclick="showAddForm()">â• ì„ ìˆ˜ ì¶”ê°€</button>
                    <button class="download-btn" onclick="downloadCSV()">ğŸ’¾ CSV ë‹¤ìš´ë¡œë“œ</button>
                </div>
                
                <!-- í•„í„° ë° ê²€ìƒ‰ -->
                <div style="margin: 20px 0; text-align: center;">
                    <div style="margin-bottom: 15px;">
                        <button id="filterToggle" onclick="toggleFilter()" 
                                style="padding: 10px 20px; border-radius: 5px; border: none; background: #667eea; color: white; font-weight: bold; cursor: pointer; margin-right: 10px;">
                            ğŸ“Œ ì•Œë¦¼ ì„¤ì •ëœ ì„ ìˆ˜ë§Œ ë³´ê¸°
                        </button>
                        <span id="notificationCount" style="color: #667eea; font-weight: bold;">ì•Œë¦¼ í™œì„±: 0/0ëª…</span>
                    </div>
                    <input type="text" id="playerSearch" placeholder="ğŸ” ì„ ìˆ˜ëª… ë˜ëŠ” ì‹œì¦Œ ê²€ìƒ‰..." 
                           style="padding: 10px; width: 300px; border-radius: 5px; border: 1px solid #ddd; font-size: 14px;"
                           onkeyup="searchPlayers()">
                    <span id="searchCount" style="margin-left: 10px; color: #667eea; font-weight: bold;"></span>
                </div>
                
                <!-- ì„ ìˆ˜ ì¶”ê°€/í¸ì§‘ í¼ -->
                <div class="player-form" id="playerForm">
                    <h3 id="formTitle">ìƒˆ ì„ ìˆ˜ ì¶”ê°€</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ì„ ìˆ˜ëª…:</label>
                            <input type="text" id="playerName" placeholder="ì˜ˆ: ë©”ì‹œ">
                        </div>
                        <div class="form-group">
                            <label>ì‹œì¦Œ:</label>
                            <input type="text" id="playerSeason" placeholder="ì˜ˆ: 22TOTY">
                        </div>
                        <div class="form-group">
                            <label>ê°±ì‹ íŒ¨í„´:</label>
                            <select id="playerPattern">
                                <option value="ì§ìˆ˜ì‹œ">ì§ìˆ˜ì‹œ</option>
                                <option value="í™€ìˆ˜ì‹œ">í™€ìˆ˜ì‹œ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ê°±ì‹ ë¶„:</label>
                            <input type="number" id="playerMinute" min="0" max="59" placeholder="ì˜ˆ: 04">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button class="save-btn" onclick="savePlayer()">ì €ì¥</button>
                        <button class="cancel-btn" onclick="hideForm()">ì·¨ì†Œ</button>
                    </div>
                </div>
                
                <div class="player-list" id="playerList">
                    <div class="no-players">ì„ ìˆ˜ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ì•Œë¦¼ íŒì—… -->
    <div class="overlay" id="overlay" onclick="closeAlert()"></div>
    <div class="alert-popup" id="alertPopup">
        <div id="alertMessage">ì•Œë¦¼</div>
        <button class="close-btn" onclick="closeAlert()">í™•ì¸</button>
    </div>

    <script>
        // Electron API ì²´í¬
        const isElectron = typeof window.electronAPI !== 'undefined';
        
        // ì „ì—­ ë³€ìˆ˜
        let timeLeft = 660; // 11ë¶„ = 660ì´ˆ
        let timerId = null;
        let isRunning = false;
        let players = [];
        let transferTimers = [];
        let editingIndex = -1;
        let notificationSettings = JSON.parse(localStorage.getItem('notificationSettings') || '{}');
        let showOnlyEnabled = true; // ê¸°ë³¸ê°’: ì•Œë¦¼ ì„¤ì •ëœ ì„ ìˆ˜ë§Œ ë³´ê¸°
        
        // í˜„ì¬ ì‹œê°„ ì—…ë°ì´íŠ¸
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleString('ko-KR', {
                timeZone: 'Asia/Seoul',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('currentTime').textContent = timeString;
        }
        
        // íƒ­ ì „í™˜
        function switchTab(tab) {
            // íƒ­ ë²„íŠ¼ í™œì„±í™”
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            // ì„¹ì…˜ í‘œì‹œ/ìˆ¨ê¹€
            document.getElementById('supervisorSection').style.display = tab === 'supervisor' ? 'block' : 'none';
            document.getElementById('transferSection').style.display = tab === 'transfer' ? 'block' : 'none';
        }
        
        // ê°ë…ëª¨ë“œ íƒ€ì´ë¨¸ í•¨ìˆ˜ë“¤
        function updateDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timerDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // íƒ€ì´ë¨¸ ì‹œì‘ (ë¶„ ë‹¨ìœ„ë¡œ ì„¤ì • ê°€ëŠ¥)
        function startTimer(minutes) {
            if (isRunning) return;
            
            // ë¶„ì´ ì§€ì •ë˜ë©´ í•´ë‹¹ ì‹œê°„ìœ¼ë¡œ ì„¤ì •
            if (minutes) {
                timeLeft = minutes * 60;
            }
            
            // ì‹œê°„ì´ 0ì´ë©´ 10ë¶„ìœ¼ë¡œ ì„¤ì •
            if (timeLeft <= 0) {
                timeLeft = 660;
            }
            
            isRunning = true;
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'inline-block';
            document.getElementById('status').textContent = 'íƒ€ì´ë¨¸ ì‘ë™ ì¤‘...';
            
            updateDisplay();
            
            // Electron í™˜ê²½ì´ë©´ ë©”ì¸ í”„ë¡œì„¸ìŠ¤ì—ë„ ì•Œë¦¼
            if (isElectron) {
                window.electronAPI.startTimer(minutes || timeLeft / 60);
            }
            
            timerId = setInterval(() => {
                timeLeft--;
                updateDisplay();
                
                if (timeLeft <= 0) {
                    showAlert('ğŸš¨ ê°ë…ëª¨ë“œ ì‹¤í–‰ ì‹œê°„!', 'FCì˜¨ë¼ì¸ì—ì„œ ê°ë…ëª¨ë“œë¥¼ ì‹¤í–‰í•˜ì„¸ìš”');
                    stopTimer(); // ì•Œë¦¼ í›„ ì •ì§€ (ë¦¬ì…‹í•˜ì§€ ì•ŠìŒ)
                }
            }, 1000);
        }

        // íƒ€ì´ë¨¸ ì •ì§€
        function stopTimer() {
            if (!isRunning) return;
            
            isRunning = false;
            clearInterval(timerId);
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('stopBtn').style.display = 'none';
            
            // Electron í™˜ê²½ì´ë©´ ë©”ì¸ í”„ë¡œì„¸ìŠ¤ì—ë„ ì•Œë¦¼
            if (isElectron) {
                window.electronAPI.stopTimer();
            }
            
            if (timeLeft <= 0) {
                document.getElementById('status').textContent = 'ì•Œë¦¼ ì™„ë£Œ - ë‹¤ì‹œ ì‹œì‘í•˜ë ¤ë©´ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”';
                timeLeft = 0; // 0ìœ¼ë¡œ ìœ ì§€
            } else {
                document.getElementById('status').textContent = 'ì¼ì‹œì •ì§€ - ê³„ì†í•˜ë ¤ë©´ ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”';
            }
            
            updateDisplay();
        }

        // 11ë¶„ìœ¼ë¡œ ë¦¬ì…‹
        function resetToEleven() {
            if (isRunning) {
                stopTimer();
            }
            timeLeft = 660; // 11ë¶„
            updateDisplay();
            document.getElementById('status').textContent = '11ë¶„ìœ¼ë¡œ ë¦¬ì…‹ë¨ - ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”';
        }

        // ì‹œê°„ ì¶”ê°€ ë˜ëŠ” ìƒˆë¡œ ì‹œì‘
        function addOrStartTimer(minutes) {
            if (isRunning) {
                // íƒ€ì´ë¨¸ ì§„í–‰ ì¤‘ì´ë©´ ì‹œê°„ ì¶”ê°€
                timeLeft += minutes * 60;
                updateDisplay();
                
                // Electron í™˜ê²½ì´ë©´ ë©”ì¸ í”„ë¡œì„¸ìŠ¤ì—ë„ ì•Œë¦¼
                if (isElectron) {
                    window.electronAPI.addTime(minutes);
                }
                
                if (minutes === 5) {
                    document.getElementById('status').textContent = `ì—°ì¥ì „ +${minutes}ë¶„ ì¶”ê°€ë¨ (ì§„í–‰ ì¤‘)`;
                } else {
                    document.getElementById('status').textContent = `+${minutes}ë¶„ ì¶”ê°€ë¨ (ì§„í–‰ ì¤‘)`;
                }
            } else {
                // íƒ€ì´ë¨¸ ì •ì§€ ìƒíƒœë©´ í•´ë‹¹ ì‹œê°„ìœ¼ë¡œ ìƒˆë¡œ ì‹œì‘
                timeLeft = minutes * 60;
                updateDisplay();
                
                if (minutes === 5) {
                    document.getElementById('status').textContent = 'ì—°ì¥ì „ 5ë¶„ íƒ€ì´ë¨¸ ì‹œì‘';
                } else {
                    document.getElementById('status').textContent = `${minutes}ë¶„ íƒ€ì´ë¨¸ ì‹œì‘`;
                }
                
                startTimer(); // ìë™ ì‹œì‘
            }
        }
        
        // CSV íŒŒì¼ ë¡œë“œ
        function loadCSV() {
            const fileInput = document.getElementById('csvFile');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const csv = e.target.result;
                parseCSV(csv);
            };
            reader.readAsText(file, 'UTF-8');
        }
        
        // CSV íŒŒì‹±
        function parseCSV(csv) {
            const lines = csv.split('\n');
            players = [];
            
            // ì²« ë²ˆì§¸ ì¤„(í—¤ë”) ì œì™¸
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const [name, season, pattern, minute] = line.split(',');
                if (name && season && pattern && minute) {
                    players.push({
                        name: name.trim(),
                        season: season.trim(),
                        pattern: pattern.trim(),
                        minute: parseInt(minute.trim())
                    });
                }
            }
            
            displayPlayers();
            setupTransferAlerts();
        }
        
        // ì„ ìˆ˜ ê²€ìƒ‰
        function searchPlayers() {
            const searchTerm = document.getElementById('playerSearch').value.toLowerCase();
            const filteredPlayers = searchTerm ? 
                players.filter(player => 
                    player.name.toLowerCase().includes(searchTerm) || 
                    player.season.toLowerCase().includes(searchTerm)
                ) : players;
            
            displayPlayers(filteredPlayers);
            
            // ê²€ìƒ‰ ê²°ê³¼ ìˆ˜ í‘œì‹œ
            const searchCount = document.getElementById('searchCount');
            if (searchTerm) {
                searchCount.textContent = `${filteredPlayers.length}ëª… ì°¾ìŒ`;
            } else {
                searchCount.textContent = '';
            }
        }
        
        // ì„ ìˆ˜ ëª©ë¡ í‘œì‹œ
        function displayPlayers(playersToShow = players) {
            const playerList = document.getElementById('playerList');
            
            // ì•Œë¦¼ ì¹´ìš´í„° ì—…ë°ì´íŠ¸
            updateNotificationCount();
            
            // í•„í„° ì ìš©
            let filteredPlayers = playersToShow;
            if (showOnlyEnabled) {
                filteredPlayers = playersToShow.filter(player => {
                    const key = `${player.season}_${player.name}`;
                    return notificationSettings[key] === true;
                });
            }
            
            if (filteredPlayers.length === 0) {
                if (players.length === 0) {
                    playerList.innerHTML = '<div class="no-players">ì„ ìˆ˜ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</div>';
                } else if (showOnlyEnabled) {
                    playerList.innerHTML = '<div class="no-players">ì•Œë¦¼ì´ ì„¤ì •ëœ ì„ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤<br>ì „ì²´ ë³´ê¸°ë¡œ ì „í™˜í•˜ì—¬ ì„ ìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>';
                } else {
                    playerList.innerHTML = '<div class="no-players">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                }
                return;
            }
            
            // ì•Œë¦¼ ì„¤ì •ëœ ì„ ìˆ˜ë¥¼ ìƒë‹¨ì— ì •ë ¬
            const sortedPlayers = [...filteredPlayers].sort((a, b) => {
                const keyA = `${a.season}_${a.name}`;
                const keyB = `${b.season}_${b.name}`;
                const enabledA = notificationSettings[keyA] || false;
                const enabledB = notificationSettings[keyB] || false;
                
                if (enabledA && !enabledB) return -1;
                if (!enabledA && enabledB) return 1;
                return 0;
            });
            
            // ì›ë³¸ ë°°ì—´ì—ì„œ ì¸ë±ìŠ¤ ì°¾ê¸°
            playerList.innerHTML = sortedPlayers.map((player) => {
                const originalIndex = players.indexOf(player);
                const nextUpdate = getNextUpdateTime(player);
                const isEditing = editingIndex === originalIndex;
                const key = `${player.season}_${player.name}`;
                const isEnabled = notificationSettings[key] || false;
                
                if (isEditing) {
                    return `
                        <div class="player-item editing">
                            <div class="player-info">
                                <input class="inline-input" value="${player.name}" id="edit-name-${originalIndex}">
                                <input class="inline-input" value="${player.season}" id="edit-season-${originalIndex}">
                                <select class="inline-input" id="edit-pattern-${originalIndex}">
                                    <option value="ì§ìˆ˜ì‹œ" ${player.pattern === 'ì§ìˆ˜ì‹œ' ? 'selected' : ''}>ì§ìˆ˜ì‹œ</option>
                                    <option value="í™€ìˆ˜ì‹œ" ${player.pattern === 'í™€ìˆ˜ì‹œ' ? 'selected' : ''}>í™€ìˆ˜ì‹œ</option>
                                </select>
                                <input class="inline-input" type="number" min="0" max="59" value="${player.minute}" id="edit-minute-${originalIndex}">
                            </div>
                            <div class="player-actions">
                                <button class="save-btn" onclick="saveEdit(${originalIndex})">ì €ì¥</button>
                                <button class="cancel-btn" onclick="cancelEdit()">ì·¨ì†Œ</button>
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="player-item ${isEnabled ? 'notification-enabled' : ''}">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" 
                                       id="notify-${originalIndex}" 
                                       ${isEnabled ? 'checked' : ''}
                                       onchange="toggleNotification(${originalIndex})"
                                       style="width: 20px; height: 20px; cursor: pointer;">
                                <div class="player-info" style="flex: 1;">
                                    <div class="player-name">
                                        ${isEnabled ? 'â­ ' : ''}${player.season} ${player.name}
                                    </div>
                                    <div class="player-details">${player.pattern} ${player.minute.toString().padStart(2, '0')}ë¶„</div>
                                    <div class="next-update">ë‹¤ìŒ: ${nextUpdate}</div>
                                </div>
                                <div class="player-actions">
                                    <button class="edit-btn" onclick="editPlayer(${originalIndex})">ìˆ˜ì •</button>
                                    <button class="delete-btn" onclick="deletePlayer(${originalIndex})">ì‚­ì œ</button>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }).join('');
        }
        
        // ì„ ìˆ˜ ì¶”ê°€ í¼ í‘œì‹œ
        function showAddForm() {
            editingIndex = -1;
            document.getElementById('formTitle').textContent = 'ìƒˆ ì„ ìˆ˜ ì¶”ê°€';
            document.getElementById('playerName').value = '';
            document.getElementById('playerSeason').value = '';
            document.getElementById('playerPattern').value = 'ì§ìˆ˜ì‹œ';
            document.getElementById('playerMinute').value = '';
            document.getElementById('playerForm').style.display = 'block';
        }
        
        // í¼ ìˆ¨ê¸°ê¸°
        function hideForm() {
            document.getElementById('playerForm').style.display = 'none';
            editingIndex = -1;
        }
        
        // ì„ ìˆ˜ ì €ì¥
        function savePlayer() {
            const name = document.getElementById('playerName').value.trim();
            const season = document.getElementById('playerSeason').value.trim();
            const pattern = document.getElementById('playerPattern').value;
            const minute = parseInt(document.getElementById('playerMinute').value);
            
            if (!name || !season || isNaN(minute) || minute < 0 || minute > 59) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const newPlayer = { name, season, pattern, minute };
            
            if (editingIndex >= 0) {
                players[editingIndex] = newPlayer;
            } else {
                players.push(newPlayer);
            }
            
            hideForm();
            displayPlayers();
            setupTransferAlerts();
        }
        
        // ì„ ìˆ˜ í¸ì§‘
        function editPlayer(index) {
            if (editingIndex >= 0) {
                cancelEdit();
            }
            editingIndex = index;
            displayPlayers();
        }
        
        // í¸ì§‘ ì €ì¥
        function saveEdit(index) {
            const name = document.getElementById(`edit-name-${index}`).value.trim();
            const season = document.getElementById(`edit-season-${index}`).value.trim();
            const pattern = document.getElementById(`edit-pattern-${index}`).value;
            const minute = parseInt(document.getElementById(`edit-minute-${index}`).value);
            
            if (!name || !season || isNaN(minute) || minute < 0 || minute > 59) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            players[index] = { name, season, pattern, minute };
            editingIndex = -1;
            displayPlayers();
            setupTransferAlerts();
        }
        
        // í¸ì§‘ ì·¨ì†Œ
        function cancelEdit() {
            editingIndex = -1;
            displayPlayers();
        }
        
        // ì„ ìˆ˜ ì‚­ì œ
        function deletePlayer(index) {
            if (confirm(`${players[index].season} ${players[index].name}ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                players.splice(index, 1);
                displayPlayers();
                setupTransferAlerts();
            }
        }
        
        // CSV ë‹¤ìš´ë¡œë“œ
        function downloadCSV() {
            if (players.length === 0) {
                alert('ë‹¤ìš´ë¡œë“œí•  ì„ ìˆ˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            let csvContent = 'ì„ ìˆ˜ëª…,ì‹œì¦Œ,ê°±ì‹ íŒ¨í„´,ê°±ì‹ ë¶„\n';
            players.forEach(player => {
                csvContent += `${player.name},${player.season},${player.pattern},${player.minute}\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'ì„ ìˆ˜ëª©ë¡.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // ë‹¤ìŒ ê°±ì‹  ì‹œê°„ ê³„ì‚°
        function getNextUpdateTime(player) {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            
            let nextHour;
            
            if (player.pattern === 'ì§ìˆ˜ì‹œ') {
                if (currentHour % 2 === 0) {
                    if (currentMinute < player.minute) {
                        nextHour = currentHour;
                    } else {
                        nextHour = currentHour + 2;
                    }
                } else {
                    nextHour = currentHour + 1;
                }
            } else {
                if (currentHour % 2 === 1) {
                    if (currentMinute < player.minute) {
                        nextHour = currentHour;
                    } else {
                        nextHour = currentHour + 2;
                    }
                } else {
                    nextHour = currentHour + 1;
                }
            }
            
            if (nextHour >= 24) {
                nextHour -= 24;
            }
            
            return `${nextHour.toString().padStart(2, '0')}:${player.minute.toString().padStart(2, '0')}`;
        }
        
        // ì´ì ì‹œì¥ ì•Œë¦¼ ì„¤ì •
        function setupTransferAlerts() {
            transferTimers.forEach(timer => clearInterval(timer));
            transferTimers = [];
            
            players.forEach(player => {
                const timer = setInterval(() => {
                    checkTransferUpdate(player);
                }, 60000);
                
                transferTimers.push(timer);
            });
        }
        
        // ì•Œë¦¼ í† ê¸€
        function toggleNotification(index) {
            const player = players[index];
            const key = `${player.season}_${player.name}`;
            notificationSettings[key] = !notificationSettings[key];
            localStorage.setItem('notificationSettings', JSON.stringify(notificationSettings));
            displayPlayers();
        }
        
        // í•„í„° í† ê¸€
        function toggleFilter() {
            showOnlyEnabled = !showOnlyEnabled;
            const button = document.getElementById('filterToggle');
            if (showOnlyEnabled) {
                button.textContent = 'ğŸ“Œ ì•Œë¦¼ ì„¤ì •ëœ ì„ ìˆ˜ë§Œ ë³´ê¸°';
                button.style.background = '#667eea';
            } else {
                button.textContent = 'ğŸ“‹ ì „ì²´ ì„ ìˆ˜ ë³´ê¸°';
                button.style.background = '#6c757d';
            }
            displayPlayers();
        }
        
        // ì•Œë¦¼ ì¹´ìš´í„° ì—…ë°ì´íŠ¸
        function updateNotificationCount() {
            const enabledCount = Object.keys(notificationSettings).filter(key => notificationSettings[key]).length;
            const totalCount = players.length;
            document.getElementById('notificationCount').textContent = `ì•Œë¦¼ í™œì„±: ${enabledCount}/${totalCount}ëª…`;
        }
        
        // ì´ì ì‹œì¥ ê°±ì‹  ì²´í¬
        function checkTransferUpdate(player) {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            
            // ì•Œë¦¼ ì„¤ì • í™•ì¸
            const key = `${player.season}_${player.name}`;
            if (!notificationSettings[key]) {
                return; // ì•Œë¦¼ OFFë©´ ì²´í¬í•˜ì§€ ì•ŠìŒ
            }
            
            let shouldAlert = false;
            
            if (player.pattern === 'ì§ìˆ˜ì‹œ' && currentHour % 2 === 0 && currentMinute === player.minute) {
                shouldAlert = true;
            } else if (player.pattern === 'í™€ìˆ˜ì‹œ' && currentHour % 2 === 1 && currentMinute === player.minute) {
                shouldAlert = true;
            }
            
            if (shouldAlert) {
                showAlert(
                    `ğŸ“ˆ ì´ì ì‹œì¥ ê°±ì‹ !`, 
                    `${player.season} ${player.name}ì˜ ì´ì ë£Œê°€ ê°±ì‹ ë˜ì—ˆìŠµë‹ˆë‹¤!`,
                    'transfer-alert'
                );
                
                // Electron í™˜ê²½ì´ë©´ ì‹œìŠ¤í…œ ì•Œë¦¼ë„ í‘œì‹œ
                if (isElectron) {
                    window.electronAPI.sendTransferAlert({
                        name: player.name,
                        season: player.season
                    });
                }
            }
        }
        
        // ì•Œë¦¼ í‘œì‹œ
        function showAlert(title, message, className = '') {
            document.getElementById('alertMessage').innerHTML = `
                <div>${title}</div>
                <div style="font-size: 16px; margin-top: 10px;">${message}</div>
            `;
            
            const popup = document.getElementById('alertPopup');
            popup.className = `alert-popup ${className}`;
            
            document.getElementById('overlay').style.display = 'block';
            popup.style.display = 'block';
            
            if (Notification.permission === 'granted') {
                new Notification(title, {
                    body: message,
                    icon: 'âš½'
                });
            }
        }
        
        // ì•Œë¦¼ ë‹«ê¸°
        function closeAlert() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('alertPopup').style.display = 'none';
            
            // ê°ë…ëª¨ë“œ ì•Œë¦¼ì´ì—ˆìœ¼ë©´ ìë™ìœ¼ë¡œ 10ë¶„ ì¬ì‹œì‘
            const alertMessage = document.getElementById('alertMessage').textContent;
            if (alertMessage.includes('ê°ë…ëª¨ë“œ')) {
                timeLeft = 660; // 11ë¶„ ì„¤ì •
                startTimer(); // ìë™ ì‹œì‘
                document.getElementById('status').textContent = '11ë¶„ íƒ€ì´ë¨¸ ìë™ ì¬ì‹œì‘ë¨';
            }
        }
        
        // ì´ˆê¸°í™”
        function init() {
            updateDisplay();
            updateCurrentTime();
            
            setInterval(updateCurrentTime, 1000);
            
            // Electron í™˜ê²½ì´ë©´ íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            if (isElectron) {
                window.electronAPI.onTimerUpdate((newTimeLeft) => {
                    timeLeft = newTimeLeft;
                    updateDisplay();
                    
                    if (newTimeLeft > 0 && !isRunning) {
                        isRunning = true;
                        document.getElementById('startBtn').style.display = 'none';
                        document.getElementById('stopBtn').style.display = 'inline-block';
                        document.getElementById('status').textContent = 'íƒ€ì´ë¨¸ ì‘ë™ ì¤‘...';
                    }
                });
            }
            
            if (Notification.permission !== 'granted' && Notification.permission !== 'denied') {
                Notification.requestPermission();
            }
            
            // all_players.csv ìë™ ë¡œë“œ
            loadDefaultCSV();
        }
        
        // ê¸°ë³¸ CSV íŒŒì¼ ë¡œë“œ
        function loadDefaultCSV() {
            fetch('all_players.csv')
                .then(response => response.text())
                .then(csv => {
                    parseCSV(csv);
                    console.log(`${players.length}ëª…ì˜ ì„ ìˆ˜ ë°ì´í„°ë¥¼ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.`);
                })
                .catch(error => {
                    console.log('ê¸°ë³¸ CSV íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¹ˆ ëª©ë¡ìœ¼ë¡œ ì‹œì‘í•©ë‹ˆë‹¤.');
                    displayPlayers();
                });
        }
        
        window.onload = init;
    </script>
</body>
</html>